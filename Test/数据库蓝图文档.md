# ğŸ“Œ LPS_Creativ ç³»ç»Ÿæ ¸å¿ƒè“å›¾ï¼ˆV1.4 æœ€ç»ˆé”å®šç‰ˆï¼‰

**æ–‡æ¡£ç”¨é€”**ï¼šåœ¨ä»»ä½•æ–°ä¼šè¯è®¨è®ºæ—¶ï¼Œä¼˜å…ˆç²˜è´´æœ¬æ–‡æ¡£ä½œä¸ºä¸Šä¸‹æ–‡åŸºå‡†ï¼Œé¿å…é‡å¤æé—®å’Œé€»è¾‘æ¼‚ç§»ã€‚

---

## 1. ç³»ç»Ÿå¯¼èˆªç»“æ„ï¼ˆæ ¸å¿ƒå®šä½ï¼‰

LPS_Creativ ç³»ç»Ÿï¼ˆFB å¹¿å‘Šè½åœ°é¡µå¿«é€Ÿç”Ÿæˆç³»ç»Ÿï¼‰

```
ä¸»ç•Œé¢ä¸‰æ¿å—ï¼š
â”œâ”€ 1. å½±ç‰‡ç´ æåº“ï¼ˆå¢åˆ æ”¹æŸ¥ + ä¸€é”®å¯¼å…¥ APIï¼‰
â”œâ”€ 2. è½åœ°é¡µå·¥ä½œæµï¼ˆæ ¸å¿ƒé¡µé¢ï¼šç”Ÿæˆèƒ½åŠ›ï¼‰
â”‚   â”œâ”€ 2.1 å·¥ä½œæµåˆ—è¡¨ï¼šå±•ç¤ºå†å²æ‰¹æ¬¡
â”‚   â”‚   â”œâ”€â”€ çŠ¶æ€æ ‡ç­¾ï¼šgenerating / pending_ad / ready / archived
â”‚   â”‚   â””â”€â”€ æ“ä½œæŒ‰é’®ï¼šæ ¹æ®çŠ¶æ€åŠ¨æ€æ˜¾ç¤ºï¼ˆä¸Šä¼  / ä¸‹è½½ / å½’æ¡£ï¼‰
â”‚   â”‚
â”‚   â””â”€ 2.2 åˆ›å»ºè½åœ°é¡µï¼ˆå¤šæ­¥éª¤è¡¨å•ï¼‰
â”‚       â”œâ”€â”€ Step 1ï¼šå‹¾é€‰è§†é¢‘ç´ æï¼ˆå¤šé€‰ï¼Œæ•°é‡å—æ¨¡æ¿ max_videos é™åˆ¶ï¼‰
â”‚       â”œâ”€â”€ Step 2ï¼šé€‰æ‹©æ¨¡æ¿ï¼ˆå•é€‰æˆ–å¤šé€‰ï¼Œæ¯ä¸ªæ¨¡æ¿ç”Ÿæˆç‹¬ç«‹è½åœ°é¡µï¼‰
â”‚       â”œâ”€â”€ Step 3ï¼šç‚¹å‡»â€œç”Ÿæˆâ€â†’ åç«¯å¼‚æ­¥æ¸²æŸ“ â†’ å®Œæˆåè‡ªåŠ¨è·³å› 2.1 åˆ—è¡¨
â”‚       â””â”€â”€ ç»“æœï¼šæ–°æ‰¹æ¬¡æ˜¾ç¤ºåœ¨åˆ—è¡¨é¡¶éƒ¨ï¼ŒçŠ¶æ€ä¸º **pending_ad**
â”‚
â”‚   [æ–°å¢] 2.3 æ‰¹æ¬¡è¯¦æƒ…é¡µ
â”‚       â”œâ”€â”€ å±•ç¤ºè¯¥æ‰¹æ¬¡æ‰€æœ‰è½åœ°é¡µ HTML
â”‚       â”œâ”€â”€ å±•ç¤ºå·²å…³è”çš„å¹¿å‘Šå›¾æ•°é‡
â”‚       â””â”€â”€ æ“ä½œï¼š[+ ä»ç´ æåº“é€‰æ‹©å›¾ç‰‡] / [+ æœ¬åœ°ä¸Šä¼ æ–°å›¾ç‰‡]
â”‚
â””â”€ 3. æŠ•æµè®¡åˆ’ï¼ˆä¸‹è½½ä¸­å¿ƒï¼‰
    â”œâ”€ 3.1 æ–°å»ºè®¡åˆ’ï¼šå‹¾é€‰ ready çŠ¶æ€çš„å·¥ä½œæµæ‰¹æ¬¡ â†’ é…ç½®æ¸ é“ / åœ°åŒº â†’ æ‰“åŒ…ä¸‹è½½
    â””â”€ 3.2 å†å²è®°å½•ï¼šå†å²æŠ•æµè®¡åˆ’åˆ—è¡¨
```

**ç³»ç»Ÿè¾¹ç•Œ**ï¼šåªè´Ÿè´£ç”Ÿæˆä¸æ‰“åŒ…ï¼Œä¸ç®¡ç†æŠ•æµé˜¶æ®µçš„ç´ æåŒ¹é…é€»è¾‘ã€‚

---

## 2. æ ¸å¿ƒä¸šåŠ¡æµç¨‹ï¼ˆä¸å¯å˜æ›´ï¼‰

- **åˆ›å»ºä¸ç”Ÿæˆ**ï¼šç¾å·¥åˆ›å»ºå·¥ä½œæµæ‰¹æ¬¡ â†’ å‹¾é€‰è§†é¢‘ â†’ é€‰æ‹©æ¨¡æ¿ â†’ ç‚¹å‡»â€œç”Ÿæˆâ€ â†’ çŠ¶æ€å˜ä¸º `pending_ad`
- **ä¸Šä¼ ç´ æ**ï¼šç¾å·¥è¿›å…¥ `pending_ad` æ‰¹æ¬¡è¯¦æƒ… â†’ ä»å…¨å±€ç´ æåº“å…³è”å¹¿å‘Šå›¾ï¼ˆâ‰¥1 å¼ ï¼‰â†’ çŠ¶æ€å˜ä¸º `ready`
- **æŠ•æµè®¡åˆ’**ï¼šæŠ•æµåŒäº‹åˆ›å»ºæŠ•æ”¾è®¡åˆ’ â†’ å‹¾é€‰ `ready` æ‰¹æ¬¡ â†’ é…ç½®æ¸ é“ / åœ°åŒº â†’ ä¸‹è½½æ‰¹æ¬¡åŒ…
- **ä¸‹è½½å†…å®¹**ï¼šæ‰¹æ¬¡ ID ç›®å½•åŒ…å«æ‰€æœ‰è½åœ°é¡µ HTML + å…³è”å¹¿å‘Šå›¾ï¼ˆå…·ä½“ä½¿ç”¨ç”±æŠ•æµåŒäº‹å†³å®šï¼‰

### çŠ¶æ€æµè½¬ï¼ˆæ˜¾å¼ `pending_ad`ï¼‰

```mermaid
stateDiagram-v2
    [*] --> draft: åˆ›å»º
    draft --> generating: ç‚¹å‡»â€œç”Ÿæˆâ€
    generating --> pending_ad: HTML ç”Ÿæˆå®Œæˆ
    pending_ad --> ready: å…³è” â‰¥1 å¼ å¹¿å‘Šå›¾
    ready --> archived: ç‚¹å‡»â€œå½’æ¡£â€
    ready --> [*]: æŠ•æµä¸‹è½½å®Œæˆï¼ˆå¯é€‰ï¼‰
```

---

## 3. å®ä½“å…³ç³»å›¾ï¼ˆERï¼‰

```mermaid
erDiagram
    VIDEO ||--o{ LANDING_PAGE : "è¢«é€‰ä¸­ï¼ˆæ•°ç»„ï¼‰"
    TEMPLATE ||--o{ LANDING_PAGE : "ç”Ÿæˆ"
    WORKFLOW ||--o{ LANDING_PAGE : "åŒ…å«"
    WORKFLOW }o--o{ AD_IMAGE_LIBRARY : "å…³è”ï¼ˆN:Nï¼‰"
    CAMPAIGN }o--o{ WORKFLOW : "å‹¾é€‰ï¼ˆN:Nï¼‰"
```

**å…³ç³»è¯´æ˜**
- VIDEO â†” LANDING_PAGEï¼šå¤šå¯¹å¤šï¼ˆ`selected_video_ids` æ•°ç»„ï¼‰
- TEMPLATE â†” LANDING_PAGEï¼šä¸€å¯¹å¤šï¼ˆå•æ¨¡æ¿ç”Ÿæˆå¤šä¸ªè½åœ°é¡µï¼‰
- WORKFLOW â†” LANDING_PAGEï¼šä¸€å¯¹å¤šï¼ˆæ‰¹æ¬¡åŒ…å«å¤šä¸ªè½åœ°é¡µï¼‰
- WORKFLOW â†” AD_IMAGE_LIBRARYï¼šå¤šå¯¹å¤šï¼ˆ`workflow_ad_map` ä¸­é—´è¡¨ï¼‰
- CAMPAIGN â†” WORKFLOWï¼šå¤šå¯¹å¤šï¼ˆ`campaign_workflow_map` ä¸­é—´è¡¨ï¼‰

---

## 4. è¡¨ç»“æ„è®¾è®¡ï¼ˆå®Œæ•´ç‰ˆï¼‰

### å®ä½“ 1ï¼š`video`ï¼ˆè§†é¢‘ç´ æåº“ï¼‰

```sql
CREATE TABLE IF NOT EXISTS video (
    id BIGINT PRIMARY KEY GENERATED ALWAYS AS IDENTITY,
    external_id VARCHAR(64),
    title VARCHAR(255) NOT NULL,
    category VARCHAR(50),
    poster_url TEXT NOT NULL,
    view_count BIGINT DEFAULT 0,
    metadata JSONB DEFAULT '{}',
    status VARCHAR(20) DEFAULT 'active',
    created_at TIMESTAMP DEFAULT NOW(),
    updated_at TIMESTAMP DEFAULT NOW()
);

CREATE UNIQUE INDEX idx_video_external_id ON video(external_id);
CREATE INDEX idx_video_category ON video(category);
CREATE INDEX idx_video_status ON video(status);
```

### å®ä½“ 2ï¼š`template`ï¼ˆè½åœ°é¡µæ¨¡æ¿åº“ï¼‰

```sql
CREATE TABLE IF NOT EXISTS template (
    id BIGINT PRIMARY KEY GENERATED ALWAYS AS IDENTITY,
    name VARCHAR(100) NOT NULL,
    description TEXT,
    thumbnail_url TEXT,
    html_file_path TEXT NOT NULL,
    max_videos INT NOT NULL,
    static_assets_path TEXT,
    status VARCHAR(20) DEFAULT 'active',
    created_at TIMESTAMP DEFAULT NOW()
);
```

### å®ä½“ 3ï¼š`workflow`ï¼ˆå·¥ä½œæµ / æ‰¹æ¬¡å®ä¾‹ï¼‰

```sql
CREATE TABLE IF NOT EXISTS workflow (
    id BIGINT PRIMARY KEY GENERATED ALWAYS AS IDENTITY,
    name VARCHAR(200) NOT NULL,
    status VARCHAR(30) NOT NULL,
    created_by VARCHAR(100) NOT NULL,
    created_at TIMESTAMP DEFAULT NOW(),
    updated_at TIMESTAMP DEFAULT NOW()
);

CREATE INDEX idx_workflow_creator ON workflow(created_by);
CREATE INDEX idx_workflow_status ON workflow(status);
```

### å®ä½“ 4ï¼š`landing_page`ï¼ˆè½åœ°é¡µå®ä¾‹ï¼‰

```sql
CREATE TABLE IF NOT EXISTS landing_page (
    id BIGINT PRIMARY KEY GENERATED ALWAYS AS IDENTITY,
    workflow_id BIGINT NOT NULL REFERENCES workflow(id) ON DELETE CASCADE,
    template_id BIGINT NOT NULL REFERENCES template(id),
    selected_video_ids BIGINT[] NOT NULL,
    generated_page_url TEXT NOT NULL,
    created_at TIMESTAMP DEFAULT NOW(),
    UNIQUE(workflow_id, template_id)
);

CREATE INDEX idx_landing_page_workflow ON landing_page(workflow_id);
CREATE INDEX idx_landing_page_template ON landing_page(template_id);
```

### å®ä½“ 5ï¼š`ad_image_library`ï¼ˆå¹¿å‘Šç´ ææ€»åº“ï¼‰

```sql
CREATE TABLE IF NOT EXISTS ad_image_library (
    id BIGINT PRIMARY KEY GENERATED ALWAYS AS IDENTITY,
    file_url TEXT NOT NULL,
    file_name VARCHAR(255),
    dimensions VARCHAR(20),
    file_size INT,
    author VARCHAR(100) NOT NULL,
    upload_batch VARCHAR(50),
    status VARCHAR(20) DEFAULT 'active',
    created_at TIMESTAMP DEFAULT NOW()
);

CREATE INDEX idx_ad_image_author ON ad_image_library(author);
CREATE INDEX idx_ad_image_batch ON ad_image_library(upload_batch);
```

### å®ä½“ 6ï¼š`workflow_ad_map`ï¼ˆæ‰¹æ¬¡ä¸ç´ æå…³è”ï¼‰

```sql
CREATE TABLE IF NOT EXISTS workflow_ad_map (
    workflow_id BIGINT NOT NULL REFERENCES workflow(id) ON DELETE CASCADE,
    ad_image_id BIGINT NOT NULL REFERENCES ad_image_library(id) ON DELETE CASCADE,
    PRIMARY KEY (workflow_id, ad_image_id)
);

CREATE INDEX idx_wam_workflow ON workflow_ad_map(workflow_id);
CREATE INDEX idx_wam_ad_image ON workflow_ad_map(ad_image_id);
```

### å®ä½“ 7ï¼š`campaign`ï¼ˆæŠ•æ”¾è®¡åˆ’ï¼‰

```sql
CREATE TABLE IF NOT EXISTS campaign (
    id BIGINT PRIMARY KEY GENERATED ALWAYS AS IDENTITY,
    name VARCHAR(200) NOT NULL,
    channels TEXT[] NOT NULL,
    regions TEXT[] NOT NULL,
    launch_time TIMESTAMP,
    status VARCHAR(20) DEFAULT 'active',
    created_by VARCHAR(100) NOT NULL,
    created_at TIMESTAMP DEFAULT NOW(),
    config JSONB DEFAULT '{}'
);

CREATE INDEX idx_campaign_creator ON campaign(created_by);
```

### å®ä½“ 8ï¼š`campaign_workflow_map`ï¼ˆæŠ•æ”¾è®¡åˆ’å…³è”è¡¨ï¼‰

```sql
CREATE TABLE IF NOT EXISTS campaign_workflow_map (
    campaign_id BIGINT NOT NULL REFERENCES campaign(id) ON DELETE CASCADE,
    workflow_id BIGINT NOT NULL REFERENCES workflow(id) ON DELETE CASCADE,
    PRIMARY KEY (campaign_id, workflow_id)
);

CREATE INDEX idx_cwm_campaign ON campaign_workflow_map(campaign_id);
CREATE INDEX idx_cwm_workflow ON campaign_workflow_map(workflow_id);
```

---

## 5. çº§è”åˆ é™¤ç­–ç•¥

| åˆ é™¤æ“ä½œ               | è¢«åˆ é™¤è¡¨            | è‡ªåŠ¨æ¸…ç†å…³è”è¡¨                  | ä¿ç•™è¡¨                                   | è¯´æ˜                                                         |
|------------------------|---------------------|---------------------------------|------------------------------------------|--------------------------------------------------------------|
| `DELETE FROM workflow` | workflow            | landing_page, workflow_ad_map   | ad_image_library, campaign_workflow_map | æ‰¹æ¬¡åˆ é™¤ï¼Œè½åœ°é¡µä¸å…³è”å…³ç³»æ¸…ç†ï¼Œç´ æåº“ä¿ç•™                   |
| `DELETE FROM ad_image_library` | ad_image_library | workflow_ad_map                | workflow, landing_page                   | åˆ é™¤ç´ æï¼Œæ¸…ç†æ‰€æœ‰å…³è”å…³ç³»                                   |
| `DELETE FROM campaign` | campaign            | campaign_workflow_map           | workflow, landing_page, ad_image_library | åˆ é™¤æŠ•æ”¾è®¡åˆ’ï¼Œæ‰¹æ¬¡åŠç´ æä¸å—å½±å“                            |

---

## 6. API å¥‘çº¦æ‘˜è¦ï¼ˆæ–°å¢ï¼‰

| æ¨¡å—     | æ¥å£ | æ–¹æ³• | è¯·æ±‚ä½“ | å“åº”ä½“ | çŠ¶æ€ç  |
|----------|------|------|--------|--------|--------|
| è§†é¢‘ç´ æ | æŸ¥è¯¢è§†é¢‘ | GET /api/videos | category, page | `{total, items: [{id, title, poster_url, category, view_count, updated_at}]}` | 200 |
|          | å¯¼å…¥ API | POST /api/videos/sync | start_date, end_date, limit | `{imported_count, updated_count}` | 200 |
|          | ä¸Šä¼ å°é¢ | POST /api/videos/{id}/poster | `file` | `{poster_url}` | 200 |
| æ¨¡æ¿ç®¡ç† | æŸ¥è¯¢æ¨¡æ¿ | GET /api/templates | - | `[{id, name, max_videos, thumbnail_url}]` | 200 |
|          | ä¸Šä¼ æ¨¡æ¿ | POST /api/templates | `{name, html_file}` | `{id}` | 201 |
| å·¥ä½œæµæ ¸å¿ƒ | åˆ›å»ºæ‰¹æ¬¡ | POST /api/workflows | `{name}` | `{id, status: "draft"}` | 201 |
|          | ç”Ÿæˆè½åœ°é¡µ | POST /api/workflows/{id}/generate | `{video_ids[], template_ids[]}` | `{workflow_id, landing_pages: [{id, url}]}` | 202 |
|          | æŸ¥è¯¢æ‰¹æ¬¡ | GET /api/workflows/{id} | - | `{id, name, status, landing_pages[], ad_images[]}` | 200 |
| å¹¿å‘Šç´ æ | æœ¬åœ°ä¸Šä¼  | POST /api/ad-images/upload | `file` | `{id, file_url}` | 201 |
|          | å…³è”åˆ°æ‰¹æ¬¡ | POST /api/workflows/{id}/ad-images | `{ad_image_ids[]}` | `{mapped_count}` | 200 |
|          | æŸ¥è¯¢ç´ æåº“ | GET /api/ad-images | `author, batch` | `{total, items: [{id, file_url}]}` | 200 |
| æŠ•æµè®¡åˆ’ | åˆ›å»ºè®¡åˆ’ | POST /api/campaigns | `{name, channels[], regions[]}` | `{id}` | 201 |
|          | å…³è”æ‰¹æ¬¡ | POST /api/campaigns/{id}/workflows | `{workflow_ids[]}` | `{mapped_count}` | 200 |
|          | ä¸‹è½½æ‰¹æ¬¡åŒ… | GET /api/campaigns/{id}/download | - | `{download_url}` | 200 |

---

## 7. è®¾è®¡å†³ç­–é”å®šï¼ˆä¸å¯æ¨ç¿»ï¼‰

- æ ¸å¿ƒä»·å€¼ï¼šå¿«é€Ÿç”Ÿæˆè½åœ°é¡µï¼ˆè§†é¢‘ç´ æ + æ¨¡æ¿ â†’ HTMLï¼‰
- æ•°æ®æµï¼šæ‰¹æ¬¡åŒ–ç»„ç»‡ï¼Œæ‰€æœ‰æ•°æ®å½’å±äº `workflow`ï¼Œä¸‹è½½æ—¶æŒ‰æ‰¹æ¬¡æ‰“åŒ…
- çŠ¶æ€ç®¡ç†ï¼š`workflow.status` æ˜¯å”¯ä¸€çŠ¶æ€æºï¼ŒæŠ•æµåªæ“ä½œ `ready` æ‰¹æ¬¡
- æ¨¡æ¿é€‰æ‹©ï¼šæ”¯æŒå¤šæ¨¡æ¿ï¼Œæ¯ä¸ªæ¨¡æ¿å¯¹åº”ç‹¬ç«‹ `landing_page`
- å¹¿å‘Šå›¾ç®¡ç†ï¼šç‹¬ç«‹å…¨å±€ç´ æåº“ `ad_image_library`ï¼Œä¸ `workflow` ä¸º N:N
- ä¸‹è½½ç»“æ„ï¼š`æ‰¹æ¬¡ID/` ç›®å½•åŒ…å«æ‰€æœ‰è½åœ°é¡µ HTML + å…³è”å¹¿å‘Šå›¾
- åˆ é™¤å®‰å…¨ï¼šåˆ é™¤ `workflow` ä¸å½±å“ç´ æåº“ï¼Œåªåˆ é™¤ `workflow_ad_map` å…³è”
- çŠ¶æ€æµè½¬ï¼šå¿…é¡»æ˜¾å¼ç»å† `pending_ad`ï¼Œç”Ÿæˆåä¸å¯è·³è¿‡å¾…ä¸Šä¼ é˜¶æ®µ

---
æ‰€ç”¨çš„æ•°æ®åº“ä¸ºMySQL æ•°æ®åå­—:"lps_creativ"  æ•°æ®åº“è´¦æˆ·"laoluo666"   æ•°æ®åº“å¯†ç "laoluo666"
## 8. ä½¿ç”¨æŒ‡å—

ä¸‹æ¬¡å¼€æ–°ä¼šè¯æ—¶ï¼Œå¤åˆ¶ä»¥ä¸‹æ¨¡æ¿ä½œä¸ºå¼€å¤´ï¼š

```
è¯·åŸºäº LPS_Creativ è“å›¾ V1.4ï¼ˆad_image_library + æ˜¾å¼ pending_ad ç‰ˆï¼‰è®¨è®º [å…·ä½“æ¨¡å—]ï¼š

--- ç²˜è´´ä¸Šé¢æ•´ä¸ªæ–‡æ¡£ ---

æˆ‘çš„é—®é¢˜æ˜¯ï¼š[å…·ä½“éœ€æ±‚]
```

**é‡è¦æé†’**ï¼šæœ¬è“å›¾å·²é”å®šç´ æå¤ç”¨é€»è¾‘ä¸æ˜¾å¼ `pending_ad` æµè½¬ï¼Œåç»­è®¨è®ºä¸å¯æ¨ç¿»ï¼Œå…¶ä»–æ¥å£ç»†èŠ‚å¯ä¼˜åŒ–ã€‚
